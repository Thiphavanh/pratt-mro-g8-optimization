CREATE OR REPLACE VIEW PWUST_REPAIR_PLAN_SEL_V AS
SELECT DISTINCT A.PART_NO AS PLAN_PART_NO,
                A.PART_CHG AS PLAN_PART_CHG,
                C.PART_NO AS SUBJECT_PART_NO,
                C.PART_CHG AS SUBJECT_PART_CHG,
                A.PLAN_NO,
                A.PLAN_TITLE,
                A.PLAN_ID,
                A.SECURITY_GROUP,
                A.PLAN_VERSION,
                A.PLAN_REVISION,
                A.PLAN_ALTERATIONS,
                D.EFF_TYPE,
                A.PLND_WORK_LOC,
                A.PLND_LOCATION_ID,
               CASE WHEN D.EFF_TYPE <> 'DATE' THEN D.EFF_FROM ELSE NULL END AS EFF_FROM,
               CASE WHEN D.EFF_TYPE <> 'DATE' THEN D.EFF_THRU ELSE NULL END AS EFF_THRU,
               CASE WHEN D.EFF_TYPE = 'DATE' THEN D.EFF_FROM_DATE ELSE NULL END AS EFF_FROM_DATE,
               CASE WHEN D.EFF_TYPE = 'DATE' THEN D.EFF_THRU_DATE ELSE NULL END AS EFF_THRU_DATE,
               A.TIME_STAMP,
               (SELECT COUNT(*) FROM SFOR_SFPL_PLAN_SUBJECT_PART   TT WHERE TT.PLAN_ID = A.PLAN_ID AND TT.PLAN_UPDT_NO = A.PLAN_UPDT_NO) AS NUMBER_TASK_PART
FROM SFPL_PLAN_V A, SFFND_DOC_TYPE_DEF B, SFOR_SFPL_PLAN_SUBJECT_PART C, SFPL_PLAN_EFF D
WHERE A.DOC_TYPE = B.DOC_TYPE
 AND A.PLAN_TYPE = B.DOC_SUB_TYPE
 AND B.INSTRUCTIONS_TYPE = 'MRO-Part'
 AND A.REV_STATUS IN('PLAN RELEASED','PLAN COMPLETE')
 AND A.PLAN_ID = C.PLAN_ID
 AND A.PLAN_UPDT_NO = C.PLAN_UPDT_NO
 AND A.PLAN_ID = D.PLAN_ID
 AND A.PLAN_VERSION = D.PLAN_VERSION
 AND A.PLAN_REVISION = D.PLAN_REVISION
 AND A.PLAN_ALTERATIONS = D.PLAN_ALTERATIONS
 AND A.DOC_TYPE = 'Process Plan'
 AND UPPER(A.PLAN_TYPE) = UPPER('REPAIR')
 AND 1=CASE WHEN D.EFF_TYPE = 'DATE' AND SYSDATE BETWEEN NVL(D.EFF_FROM_DATE,SYSDATE) AND NVL(D.EFF_THRU_DATE,SYSDATE) THEN 1 ELSE 0  END;
 
 
 GRANT SELECT ON PWUST_REPAIR_PLAN_SEL_V TO PRATT_READ_ONLY ;
GRANT SELECT ON PWUST_REPAIR_PLAN_SEL_V TO SF$CONNECTION_POOL;